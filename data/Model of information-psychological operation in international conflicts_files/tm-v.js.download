var DragHandler={_oElem:null,attach:function(c){c.onmousedown=DragHandler._dragBegin;c.dragBegin=new Function();c.drag=new Function();c.dragEnd=new Function();return c},_dragBegin:function(i){var h=DragHandler._oElem=this;if(isNaN(parseInt(h.style.left))){h.style.left="20px"}if(isNaN(parseInt(h.style.top))){h.style.top="20px"}var e=parseInt(h.style.left);var g=parseInt(h.style.top);i=i?i:window.event;h.mouseX=i.clientX;h.mouseY=i.clientY;h.dragBegin(h,e,g);document.onmousemove=DragHandler._drag;document.onmouseup=DragHandler._dragEnd;return false},_drag:function(k){var j=DragHandler._oElem;var e=parseInt(j.style.left);var i=parseInt(j.style.top);k=k?k:window.event;var l=0;if(self.innerWidth){l=self.innerWidth}else{if(document.documentElement&&document.documentElement.clientHeight){l=document.documentElement.clientWidth}else{if(document.body){l=document.body.clientWidth}}}var m=0;if(self.innerHeight){m=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){m=document.documentElement.clientHeight}else{if(document.body){m=document.body.clientHeight}}}e=e+(k.clientX-j.mouseX);i=i+(k.clientY-j.mouseY);if(e<5){e=5}if(i<5){i=5}if(e>l-j.clientWidth){e=l-j.clientWidth}if(i>m-j.clientHeight){i=m-j.clientHeight}j.style.left=e+"px";j.style.top=i+"px";j.mouseX=k.clientX;j.mouseY=k.clientY;j.drag(j,e,i);return false},_dragEnd:function(){var g=DragHandler._oElem;var e=parseInt(g.style.left);var f=parseInt(g.style.top);g.dragEnd(g,e,f);document.onmousemove=null;document.onmouseup=null;document.onmouseup=_mouseUp;DragHandler._oElem=null}};function addEllipsis(g,f,e){f=f||140;e=e||"...";if(g.length>f){f-=e.length;g=g.substring(0,f);g+=e}return g}function _updateShareButtons(){var c=jQuery(".textmarker-panel-body").find(".share-buttons:visible").hide();jQuery(_getShareButtonsHtml(null)).insertBefore(c)}function _getShareButtonsHtml(e,u){e=e||"";var y=false;if(e.length<1){y=true;try{var q=jQuery(".textmarker").get(0).className.replace(/textmarker/,"").trim();jQuery("."+q).each(function(){e+=" "+jQuery(this).text().trim()})}catch(t){}}if(e.length<1){e=document.title}e=jQuery.trim(e);e='"'+e+'"';var r=encodeURI("url="+markerUrl+"&cid="+communicationKey)+"&st="+encodeURIComponent(e);var v="fb-share-"+(new Date()).valueOf()+"_"+Math.floor(Math.random()*1000);var x='<iframe MARGINWIDTH="0" MARGINHEIGHT="0" ALLOWTRANSPARENCY="true" frameborder="0" scrolling="no" name="'+v+'" id="'+v+'" style="float:left;  height:'+((u==1||u==2)?"38":"21")+"px; width: "+((u==1||u==2)?"29":"65")+"px; padding-left:0px;"+((u==1||u==2)?"":" margin:2px; margin-top: 3px;")+'" src="'+comUrl+"fbfeed?"+r+"&ver="+(u?u:"")+"&t="+TMmode+"&mp="+(y?1:"")+'"></iframe>';var p=" "+markerUrl+" via @markerto";var w=addEllipsis(e,140-p.length);var z="";if(u==1||u==2){z='<div class="viewer-twitter-button" onClick="javascript:_shareMarkerLinkTwitter(\''+encodeURIComponent(w)+"')\"></div>"}else{z='<div class="textmarker-twitter-btn" onClick="javascript:_shareMarkerLinkTwitter(\''+encodeURIComponent(w)+"')\"></div>"}var A="";if(typeof TMexperimentTries=="undefined"){TMexperimentTries=0}try{switch(cxApi.chooseVariation()){case 1:A="premium";break;case 2:A="help_us";break;case 3:A="support_us";break;default:A="donate"}}catch(t){console.log("Failed to choose donate button variation"+t);if(TMexperimentTries<5){TMexperimentTries++;setTimeout(_updateShareButtons,1000)}else{A="donate"}}var s=A==""?"":'<div class="textmarker-donate"><a href="http://marker.to/premium?action='+A+'" id="textmarker_donate_btn" target="_blank" ><div class="textmarker-'+A+'-btn"></div></a></div>';return'<div class="share-buttons">'+z+x+s+"</div>"}function _getShareHtml(i,k){var h='<div class="share-text">'+TM_i18n.get("shareWith")+"</div>";var j="";var g="";if(TMmode=="panel"){j='<div class="textmarker-saving"></div><div class="textmarker-url"></div>'}return'<div class="textmarker-share">'+(i?h:"")+j+_getShareButtonsHtml(k)+g+"</div>"}function _getViewerHtml(p){var u=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase());if(u&&$("head link[rel='stylesheet']")){$("head link[rel='stylesheet']").last().after('<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/lnmengjdnfjbochkdkcjbbpildacancp">')}else{u=false}var l='<div class="textmarker-close"></div>';var q='<div class="viewer-callforaction">'+TM_i18n.get("wantToHighlight")+"</div>";var m='<div class="viewer-install-action"><a '+(u?'onclick="chrome.webstore.install();"':'href="http://marker.to/install?panel=1&v='+p+'"')+'  class="install-button">'+TM_i18n.get("getHighlighter")+"</a></div>";var t='<div class="viewer-share-text"><div class="viewer-share-label">'+TM_i18n.get("reShare")+':</div><div class="viewer-share-images"><div class="viewer-facebook-button"></div></div></div>';var o='<div class="viewer-share-buttons">'+_getShareButtonsHtml(null,p)+"</div>";var r='<div class="viewer-org-page"><a target="_blank" class="viewer-original-page-link" href="'+originalPage+'">'+TM_i18n.get("originalPage")+"&nbsp;&raquo;</a></div>";var n="";if(typeof TMClicks!="undefined"){n+='<div class="viewer-click-count-container"><div class="viewer-click-count-label">'+TMClicks+" "+((TMClicks==1)?TM_i18n.get("viewerClickCountLabelOne"):TM_i18n.get("viewerClickCountLabelMore"))+"</div></div>"}var s=q+m;if(marker.pi){s=_getMarkerDonateFrame(p)}if(p==2){return'<div class="viewer-left">'+s+'</div><div class="viewer-divider"></div>'+o+'<div class="viewer-divider"></div><div class="viewer-right">'+n+r+'</div><div class="viewer-divider"></div><div class="viewer-ad-block">'+_getViewerBanner()+"</div>"+l}return'<div class="viewer-pointer"></div><div class="viewer-left">'+s+'</div><div class="viewer-divider"></div><div class="viewer-right">'+o+n+r+"</div>"+l}function _getViewerBanner(){return'                                                                                        				<style>                                                                             		.viewer-responsive { width: 100px; height: 90px; }                                          		@media(min-width: 820px)  { .viewer-responsive { width: 320px; height: 90px; } }					@media(min-width: 970px) { .viewer-responsive { width: 468px; height: 90px; } }            		@media(min-width: 1230px) { .viewer-responsive { width: 728px; height: 90px; } }            		@media(min-width: 1420px) { .viewer-responsive { width: 920px; height: 90px; } }            		</style>                                                                                    			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><\/script>  				<!-- Viewer Responsive -->                                                          			<ins class="adsbygoogle viewer-responsive"                                              			style="display:inline-block"                                                            			data-ad-client="ca-pub-6610075968954030"                                                			data-ad-slot="3617128152"></ins>                                                        			<script>                                                                                			(adsbygoogle = window.adsbygoogle || []).push({});                                      		<\/script>                                                                                   	'}function _closeTextMarkerViewer(g){g=g||false;if(typeof TMmode!="undefined"&&TMmode=="viewer"&&!g){var e=jQuery("#markerto_ads_frame").get(0);if(!e){jQuery("#textmarker .viewer-left").get(0).innerHTML=_getMarkerDonateFrame();e=jQuery("#markerto_ads_frame").get(0);e.onload=e.onreadystatechange=function(){if(typeof e.readyState=="undefined"||e.readyState=="interactive"){_closeTextMarkerViewer()}};return}try{e.contentWindow.startCloseCountdown()}catch(f){setTimeout("_closeTextMarkerViewer()",50)}return}document.body.style.cursor="default";jQuery("#textmarker").remove();TMmode="widget"}function _getMarkerDonateFrame(d){d=d||TMviewerVersion||1;var e="width:190px; height:86px;";if(d==2){e="width:250px; height:90px;"}return'<iframe id="markerto_ads_frame" src="'+comUrl+"ads"+(!marker.pi?"/viewer":"")+"?viewerVersion="+d+'" MARGINWIDTH="0" MARGINHEIGHT="0" ALLOWTRANSPARENCY="true" frameborder="0" scrolling="no" style="'+e+'"></iframe>'}function _initMarkerPanel(){var r='<div class="textmarker-logo"></div>';var m="";var s="";var u=2;if(typeof TMmode!="undefined"&&TMmode=="viewer"){m=_getViewerHtml(u);jQuery("#"+tmdiv).append('<div id="textmarker" class="viewer-panel viewer-panel-'+u+'">'+m+"</div>")}else{m=_getShareHtml(true,null);var p='<div class="textmarker-panel-body">'+m+s+"</div>";var l='<div class="textmarker-close"></div>';jQuery("#"+tmdiv).append('<div id="textmarker" class="textmarker-panel viewer">'+r+p+l+"</div>")}var n=marker.x,o=marker.y;if(n>0||o>0){var q=jQuery(jQuery(".textmarker").get(0)).offset();if(q){n=q.left+5}var t=jQuery("#textmarker").width()+10;if(n>jQuery(window).width()-t){n=jQuery(window).width()-t}o=20;if(!(TMmode=="viewer"&&u==2)){jQuery("#textmarker").get(0).style.left=n+"px";jQuery("#textmarker").get(0).style.top=o+"px"}}jQuery(".textmarker").animate({opacity:0.2},200).animate({opacity:1});jQuery(".textmarker-close").click(function(){_closeTextMarkerViewer()});jQuery(".textmarker-logo").click(function(){window.open("http://marker.to")});if(!(TMmode=="viewer"&&u==2)){DragHandler.attach(jQuery("#textmarker").get(0));jQuery("#textmarker").get(0).dragEnd=function(b,c,d){try{jQuery("#textmarker .viewer-pointer").remove();jQuery("#textmarker").addClass("without-left-pointer");if(c==marker.x&&d==marker.y){return}}catch(e){}marker.x=c;marker.y=d;jQuery("#tmloading").append('<div style="display:none"><iframe width="0" height="0" src="'+comUrl+"cookie?name=xy&value="+c+";"+d+'"></frame></div>')};jQuery("#textmarker").get(0).style.width=(jQuery("#textmarker").width()+10)+"px"}else{jQuery("body").css("padding-top","100px")}}function _shareMarkerLinkTwitter(c){_TMtwitterWindow=window.open("http://twitter.com/share?url="+markerUrl+"&via=markerto&text="+c,"twitter","width=650,height=550");if(window.focus){_TMtwitterWindow.focus()}}TM_i18n={en:{viewerClickCountLabelOne:"view",viewerClickCountLabelMore:"views",shareSelectedText:"Share It!",myMarkersLink:"My highlighed pages",howToMarkOtherSites:"How to highlight other pages?",whatIsMarker:"What is it?",content:'This is highlighted with <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Original page",shareWith:"Share this highlighted page:",closeWarningA:"Some of your work has not saved! Are you sure you want to close TextMarker?",closeWarningB:"You are closing TextMarker.",tooltip:"This is address for your highlighted page.<BR/>Share and bookmark this address!",shareWith:"Link to your highlighted page:",comKeyError:"Sorry, hightlighter cannot be used on this web page currently.",geoLocationTooltip:"Set Geolocation for selected text",removeHighlightTooltip:"Remove this highlight",wantToHighlight:"Would you like to highlight web like that?",getHighlighter:"Install Highlighter",reShare:"Share",tagsTooltip:"Add tags",pleaseWait:"Please wait until marker is fully initialized."},et:{viewerClickCountLabelOne:"vaatamine",viewerClickCountLabelMore:"vaatamist",myMarkersLink:"Minu märgitud lehed",howToMarkOtherSites:"Kuidas märkida teisi lehti?",whatIsMarker:"Mis see on?",content:'Leht märgiti <a target="_blank" href="http://marker.to/">marker.to</a> tööriistaga<BR/>',originalPage:"Originaallehekülg",shareWith:"Märgitud lehe link:",closeWarningA:"Teil on märkimine pooleli! Kas te soovite lehelt lahkuda?",closeWarningB:"Te sulgete markeri.",tooltip:"Siin on aadress teie märgendatud lehele.<BR/>Jaga ja bookmargi seda aadressi!",shareWith:"Jaga seda märgendatud lehte:",comKeyError:"Kahjuks ei saa sellel veebilehtel Marker-it hetkel kasutada.",wantToHighlight:"Soovid ka veebis olulist infot ära märkida?",getHighlighter:"Instelleeri Marker",pleaseWait:"Palun oota kuni marker on täielikult laetud."},es:{viewerClickCountLabelOne:"click",viewerClickCountLabelMore:"clicks",myMarkersLink:"Mis Páginas Resaltadas",howToMarkOtherSites:"¿Como resaltar otras páginas?",whatIsMarker:"¿Qué es esto?",content:'Esto está resaltado con <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Página original",shareWith:"Comparte esta página resaltada:",closeWarningA:"¡No has guardado todo tu trabajo! ¿Estas seguro que quieres cerrar marker.to?",closeWarningB:"Estas cerrando marker.to",tooltip:"¡Esta es la dirección de tu pagina resaltada.<BR/>Comparte y agrega a marcadores esta dirección!",shareWith:"Enlace a tu pagina resaltada:",comKeyError:"Lo sentimos, el resaltador no se puede usar en esta página por el momento",wantToHighlight:"Quieres destacar tus páginas así?",getHighlighter:"Instala Highlighter"},pt:{viewerClickCountLabelOne:"visita",viewerClickCountLabelMore:"visitas",myMarkersLink:"As minhas páginas sublinhadas",howToMarkOtherSites:"Como sublinhar outras páginas?",whatIsMarker:"O que é?",content:'Sublinhado com <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Página original",shareWith:"Partilhar esta página sublinhada:",closeWarningA:"Existe trabalho não guardado! Tem a certeza que deseja fechar marker.to?",closeWarningB:"Está a fechar marker.to",tooltip:"Este é o endereço para a sua página sublinhada.<BR/> Adicione aos favoritos e partilhe o endereço!",shareWith:"Endereço para a sua página sublinhada:",comKeyError:"O marcador não pode ser utilizado na página actual.",wantToHighlight:"Gostaria de destacar suas páginas assim?",getHighlighter:"Instale o Highlighter"},ru:{viewerClickCountLabelOne:"клик",viewerClickCountLabelMore:"кликов",myMarkersLink:"Мои помеченные страницы",howToMarkOtherSites:"Как пометить другие страницы?",whatIsMarker:"Что это такое?",content:'Помечено с <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Исходная страница",shareWith:"Поделитесь с другими об отмеченной странице:",closeWarningA:"Ваша работа ещё не полностью сохранена, Вы уверены что хотите закрыть marker.to?",closeWarningB:"Вы закрываете marker.to",tooltip:"Это адрес для Вашей страницы, сделайте на;<BR/> неё закладку и поделитесь с другими!",shareWith:"Сcылка на отмеченную Вами страницу:",comKeyError:"Извините, но на этой странице невозможно использовать маркер.",wantToHighlight:"Хотите так отмечать веб-страницы?",getHighlighter:"Установить маркер"},it:{viewerClickCountLabelOne:"click",viewerClickCountLabelMore:"clicks",myMarkersLink:"La mia pagina evidenziata",howToMarkOtherSites:"Come si evidenziano le altre pagine?",whatIsMarker:"Cos'è Marker.to?",content:'La pagina è stata sottolineata con <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Pagina originale",shareWith:"Condividi la tua pagina sottolineata:",closeWarningA:"Alcune tue modifiche non sono state salvate. Sei sicuro di voler chiudere questa pagina?",closeWarningB:"Stai chiudendo marker.to",tooltip:"Questo è l'indirizzo della tua pagina <BR/>sottolineata.Copialo e condividilo!",shareWith:"Link alla tua pagina evidenziata:",comKeyError:"Ci dispiace, l'evidenziatore non può essere ancora utilizzato in questa pagina."},fr:{viewerClickCountLabelOne:"clique",viewerClickCountLabelMore:"cliques",myMarkersLink:"Mes pages mises en surbrillance",howToMarkOtherSites:"Comment mettre d'autres pages en surbrillance?",whatIsMarker:"Qu'est-ce que c'est?",content:'Souligne avec <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Page originale",shareWith:"Partager cette page mise en surbrillance:",closeWarningA:"Votre session n'a pas ete enregistree! Etes vous sur de vouloir fermer marker.to?",closeWarningB:"Vous fermez marker.to",tooltip:"Ceci est l'adresse de votre page en surbrillance. Ajouter un signet et partager l'adresse!",shareWith:"Lien a votre page mise en surbrillance:",comKeyError:"Désolé, la surbrillance ne peut pas être utilisée sur cette page web actuellement.",wantToHighlight:"Voulez vous surligner vos pages comme cela?",getHighlighter:"Installez Highlighter"},pl:{viewerClickCountLabelOne:"widok",viewerClickCountLabelMore:"widoki",myMarkersLink:"Moje zakreślone strony",howToMarkOtherSites:"Jak zakreślić inne strony?",whatIsMarker:"Co to jest?",content:"Zakreślono przy pomocy marker.to<BR/>",originalPage:"Strona oryginalna",shareWith:"Udostępnij tę zakreśloną stronę:",closeWarningA:"Twoja praca nie została zapisana. Zamknąć marker.to?",closeWarningB:"Zamykasz marker.to",tooltip:"To adres do zakreślonej przez ciebie strony.<BR/>Dodaj stronę do zakładek i udostępnij adres!",shareWith:"Link do zakreślonej przez ciebie strony:",comKeyError:"Przepraszamy, zakreślacz nie może być obecnie użyty na tej stronie."},sv:{viewerClickCountLabelOne:"klick",viewerClickCountLabelMore:"klick",myMarkersLink:"Mina markerade sidor",howToMarkOtherSites:"Hur kan man markera andra sidor?",whatIsMarker:"Vad är detta?",content:'Detta är markerat med <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"Originalsida",shareWith:"Dela denna markerade sida:",closeWarningA:"Är du säker på att du vill stänga marker.to utan att spara?",closeWarningB:"Du stänger nu marker.to",tooltip:"Det här är adressen till din markerade sida.<BR/> Sätt ett bokmärke och dela!",shareWith:"Länk till din markerad sida:",comKeyError:"Tyvärr det går inte att markera på denna sida just nu."},de:{viewerClickCountLabelOne:"Klick",viewerClickCountLabelMore:"Klicken",myMarkersLink:"Meine markierten Seiten",howToMarkOtherSites:"Wie markierte man weitere Seiten?",whatIsMarker:"Was ist Marker?",content:'Markiert durch <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"ursprüngliche Seite",shareWith:"Markierte Seite empfehlen:",closeWarningA:"Teile Ihrer Arbeit wurden nicht gespeichert. Wollen Sie wirklich Marker.to schliessen?",closeWarningB:"Sie schliessen marker.to",tooltip:"Dies ist die Internetadresse ihrer markierten Seiten.<BR/>Bookmarken und empfehlen Sie sie weiter!",shareWith:"Links zu einer markierten Seite:",comKeyError:"Der Marker kann leider zur Zeit nicht auf dieser Internetseite benutzt werden."},th:{viewerClickCountLabelOne:"ครั้ง",viewerClickCountLabelMore:"ครั้ั้ง",myMarkersLink:"หน้าเว็บที่ฉันทำไฮไลท์เอาไว้",howToMarkOtherSites:"วิธีไฮไลท์หน้าเว็บเพจอื่นๆ?",whatIsMarker:"นี่คืออะไร?",content:'เว็บนี้ไฮไลท์ด้วยบริการจากเว็บ <a target="_blank" href="http://marker.to">marker.to</a><BR/>',originalPage:"หน้้าเว็บต้นฉบับ",shareWith:"แบ่งปันหน้าเพจที่ไฮไลท์แล้วให้ผู้อื่น:",closeWarningA:"คุณยังไม่ได้สั่งบันทึก คุณมั่นใจหรือว่าจะปิดหน้านี้โดยไม่บันทึก?",closeWarningB:"คุณกำลังปิดหน้าของ marker.to",tooltip:"ด้านล่างคือลิงก์สำหรับหน้าเว็บที่ไฮไลท์ข้อความแล้ว คุณสามารถเลือกบุ๊กมาร์กหรือแบ่งปันลิงก์นี้ให้ผู้อื่นได้ทันที",shareWith:"ลิงก์ไปยังหน้าที่คุณไฮไลท์ข้อความไว้:",comKeyError:"ขออภัยค่ะ ขณะนี้ไม่สามารถปากกาไฮไลท์ในหน้าเว็บเพจนี้ได้ค่ะ."},zh:{viewerClickCountLabelOne:"点击",viewerClickCountLabelMore:"点击",shareSelectedText:"加亮并分享",myMarkersLink:"我加亮的页面",howToMarkOtherSites:"如何加亮其它页面？",whatIsMarker:"这是什么？",content:'这个页面是通过<a target="_blank" href="http://marker.to">marker.to</a>加亮的<BR/>',originalPage:"原始网页",shareWith:"分享这个加亮的网页",closeWarningA:"你修改的部分内容还未保存，你确定要关闭marker.to吗？",closeWarningB:"你正在关闭marker.to",tooltip:"这个是你加亮页面的网址，<BR/>把它加入书签并分享它吧！",shareWith:"链接到你加亮的网页",comKeyError:"抱歉，目前在本网页不能使用加亮器"},get:function(e){var i,g;try{g=(window.navigator.userLanguage||window.navigator.language).split("-")[0]}catch(h){}i=(TM_config.i18n?TM_config.i18n:(g?g:"en"));if(typeof TM_i18n[i]=="undefined"){i="en"}if(typeof TM_i18n[i]!="undefined"){if(typeof TM_i18n[i][e]!="undefined"){e=TM_i18n[i][e]}else{if(i!="en"&&typeof TM_i18n.en[e]!="undefined"){e=TM_i18n.en[e]}}}return e}};var tmdiv="tmloading";var donotselect=false;var myhistory=[];var tmbgcolor="#FFFF00";var selection_count=0;var communicationKey=communicationKey||false;var markerUrl=markerUrl||false;var marker=marker||{};var _mouseUpOld=document.onmouseup;var TM=true;var TMinit=false;var TM_config=typeof TM_config!="undefined"?TM_config:{};var TM_origUrl=typeof TM_origUrl!="undefined"?TM_origUrl:window.location;var markerLoader=markerLoader||"";var _gaq=_gaq||[];if(typeof window.console=="undefined"){window.console={log:function(){}}}function _getCommunicationKey(){var e="l="+markerLoader;var d=TM_origUrl.href.replace("http://","http_").replace("https://","https_");e+="&url="+encodeURIComponent(d);e+="&title="+encodeURIComponent(document.title);e+="&charset="+(document.characterSet||document.charset);loadScript(comUrl+"init?"+e+"&"+(new Date()).valueOf()+"_"+Math.floor(Math.random()*1000))}function loadScript(e){var d=document.createElement("script");d.type="text/javascript";d.src=e;document.getElementById("tmloading").appendChild(d)}TMCom=function(){var t,l=0,r="loaded",s,m,o=false;function p(e){var b=[["key"],["pageContent"],["version"],["historyno"],["selectiontext"],["characterset"],["operation"],["idmodified"],["d"]];for(var c=0;c<b.length;c++){b[c][1]=document.createElement("input");try{e[b[c][0]]=b[c][1]}catch(d){}b[c][1].name=b[c][0];b[c][1].type="hidden";e.appendChild(b[c][1])}}function q(){if(t){return}var c="tmcommunicationframe";t=document.createElement("form");t.action=comUrl+"save?comId="+communicationKey+"&debugUser="+marker.user;t.method="post";t.enctype=t.encoding="multipart/form-data";document.getElementById(tmdiv).appendChild(t);p(t);m=document.createElement("div");m.style.display="none";m.innerHTML='<iframe width="0" height="0" id="'+c+'" name="'+c+'" src="javascript:void(0)"></iframe>';s=m.firstChild;function b(){TMCom.status="loaded";jQuery(".textmarker-saving").hide();if(l<myhistory.length){TMCom.send()}var g=communicationKey.split(".");g=g[0];var f={url:markerUrl,id:g,text:encodeURIComponent(t.selectiontext.value),operation:t.operation.value};if(typeof TMcallback=="function"){try{TMcallback(f)}catch(e){console.log("DEBUG: Callback failed: ",e)}}if(typeof TMcallback=="string"){jQuery.ajax({url:TMcallback,data:f,type:"POST"})}}window.addEventListener("message",d,false);function d(e){if(e.data.from!="tm"){return}if(e.data.success==true){b();return}if(!e.data.success&&e.data.msg=="failed"){alert(TM_i18n.get("comKeyError"));TM_track.record("comKeyError2",null,null,{url:encodeURIComponent(TM_origUrl)});b();return}if(!e.data.success&&!e.data.msg){if(!o){o=true;jQuery(".textmarker-saving").show();TMCom.status="loading";u()}o=true}}t.key.value=communicationKey;t.characterset.value=document.characterSet||document.charset;t.d.value=marker.d;t.appendChild(m);t.target=c;s.onload=s.onreadystatechange=function(){if(typeof s.readyState=="undefined"||s.readyState=="interactive"){b()}}}function u(b){q();n(t);if(o){var c={};jQuery(t).find("input").each(function(e,d){c[d.name]=jQuery(d).val()});s.contentWindow.postMessage(c,"//marker.to")}else{t.submit()}}function n(b){jQuery(".textmarker-tooltip-edit-wrapper").remove();b.pageContent.value=document.documentElement.innerHTML.replace(document.getElementById(tmdiv).innerHTML,"");b.historyno.value=myhistory.length-1;if(myhistory.length>0){b.selectiontext.value=encodeURIComponent(myhistory[myhistory.length-1].selectiontext);b.operation.value=myhistory[myhistory.length-1].operation;if(myhistory[myhistory.length-1].operation=="deleted"){b.idmodified.value=myhistory[myhistory.length-1].delid}if(myhistory[myhistory.length-1].operation=="rewrap"){b.idmodified.value=myhistory[myhistory.length-1].rewrappedid}if(myhistory[myhistory.length-1].operation=="selection"){b.idmodified.value=myhistory.length-1}}else{b.selectiontext.value="";b.operation.value="init";b.idmodified.value=""}}return{status:"loaded",getStatus:function(){return TMCom.status},send:function(){if(!_checkComKey()){return}if(TMCom.getStatus()=="loading"){return}TMCom.status="loading";if(myhistory.length>0){_updateShareButtons()}jQuery(".textmarker-saving").show();l=myhistory.length;u()}}}();function _checkComKey(c){c=c||false;if(!communicationKey||communicationKey.split(".").length!=2){if(c){TM_track.record("comKeyError",null,null,{url:encodeURIComponent(TM_origUrl)});if(markerLoader=="chrome-quickstart-tw"||markerLoader=="chrome-quickstart-fb"){alert(TM_i18n.get("pleaseWait"))}}return false}return true}function startMarker(m){if(m&&m.status=="success"){jQuery("#"+tmdiv).append('<style type="text/css">body, html { cursor: url(//marker.to/img/yellowarrow2.gif), auto; cursor: url(//marker.to/img/yellowarrow2.cur);}</style>');communicationKey=m.key;markerUrl=m.url;marker=m;TM_config.i18n=marker.locale;var n=false;if(markerLoader=="chrome-quickstart-tw"||markerLoader=="chrome-quickstart-fb"){n=true}if(!n){window.onbeforeunload=WarnUser}try{_gaq.push(["TM._setAccount","UA-19614689-2"]);_gaq.push(["TM._setDomainName","marker.to"]);TM_track.setIdentifier(marker.user);TM_track.record("startmarker");TM_track.record(markerLoader)}catch(l){console.log("Tracking error",l)}}else{if(TMmode=="panel"){TM_track.record("markerreopen")}}if(!n){jQuery("#loading").remove();if(jQuery("#textmarker").get(0)){return}_initMarkerPanel();if(TMmode=="viewer"){TM_track.record("startviewer");TM_track.setIdentifier(TMUserKey);return}jQuery(".textmarker-panel-body .textmarker-url").append('<input id="textmarker-url-input" value="'+markerUrl+'" />');jQuery("#textmarker-url-input").click(function(){jQuery(this).select()});jQuery("#textmarker-url-input").dblclick(function(){window.open(markerUrl);return false});jQuery("#tmloading").append('<div style="display:none"><iframe id="tm-savetags-frm" width="0" height="0" src="'+comUrl+'savetags"></frame></div>');if(marker.ttdis!="1"){jQuery("#textmarker").append('<div class="textmarker-tt"><div class="textmarker-tt-txt">'+TM_i18n.get("tooltip")+'</div><div class="textmarker-tt-close"></div></div>');jQuery(".textmarker-tt-close").click(function(){jQuery(".textmarker-tt").remove();jQuery("#tmloading").append('<div style="display:none"><iframe width="0" height="0" src="'+comUrl+'cookie?name=ttdis&value=1"></frame></div>')})}document.body.style.cursor=""}if(m){jQuery("script").each(function(c,b){var d=/marker.to\/js\/l\.js/;if(d.test(b.src)){if(b.parentNode.id!=tmdiv){jQuery(b).remove()}}});TMCom.send()}_initSelection();var j=myhistory.length>0?myhistory[myhistory.length-1].selectiontext:"";if(markerLoader=="chrome-quickstart-fb"){var k="https://www.facebook.com/dialog/feed?%20app_id=165160940187926&display=popup&caption=Highlighted%20with%20marker.to&name="+encodeURIComponent(document.title)+"&link="+encodeURIComponent(markerUrl)+"&redirect_uri="+encodeURIComponent("http://marker.to/install/done")+"&picture=http%3A%2F%2Fstatic.marker.to%2Fmarker-logo.png&description="+encodeURIComponent(j)+"&";window.postMessage({type:"FROM_MARKERTO_PAGE",data:{dataForExtension:{method:"openShareDialog",url:k}}},"*")}else{if(markerLoader=="chrome-quickstart-tw"){var e=" "+markerUrl+" via @markerto";var o=encodeURIComponent(addEllipsis(j,140-e.length));window.postMessage({type:"FROM_MARKERTO_PAGE",data:{dataForExtension:{method:"openShareDialog",url:"http://twitter.com/share?url="+markerUrl+"&via=markerto&text="+o}}},"*")}}(function(){var d=document.createElement("script");d.type="text/javascript";d.src=("https:"==document.location.protocol?"https://":"http://")+"google-analytics.com/cx/api.js?experiment=U4N5c0BIT7mpSC-FWW2Yvg";var f;try{f=document.getElementById("tmloading");f.parentNode.insertBefore(d,f)}catch(c){f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(d,f)}var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";try{f=document.getElementById("tmloading");f.parentNode.insertBefore(b,f)}catch(c){f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(b,f)}})();if(!window.postMessage){jQuery("#tmloading").append('<div style="display:none"><iframe width="0" height="0" src="'+comUrl+'log/postMessageMissing"></frame></div>')}}Function.prototype.createDelegate=function(e){var d=this;return function(){return d.apply(e,arguments)}};function colorSelectBtn(i){var g=["FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0"];var j=jQuery(document.createElement("div"));var h=myhistory[i].bgcolor.substring(1);j.addClass("textmarker-color-palette");for(var k=0;k<g.length;k++){a=document.createElement("a");if(h&&g[k]==h){continue;a.className="textmarker-color-palette-sel"}a.setAttribute("hidefocus","on");a._color=g[k];a.innerHTML='<em><span style="background:#'+g[k]+'" unselectable="on">&#160;</span></em>';j.append(a);jQuery(a).bind("click",function(b){b.preventDefault();tmbgcolor="#"+this._color;rewrap(i,"#"+this._color)})}return j}function _buttonInit(c){TMmode="panel";markerLoader=1;jQuery("#"+tmdiv).append("<div id='loading'><h4 style='z-index:10000;position:absolute;top:"+((document.body.scrollTop||document.documentElement.scrollTop)+10)+"px;background-color:#eee'>LOADING...</h4></div>");_init()}function _buildWidgetButton(){if(typeof TmButtonInitialized=="undefined"){TmButtonInitialized=true;jQuery(".marker-button").each(function(h,l){var k=jQuery(this).children(".widget-start-marker");if(k.length<1){k=document.createElement("div");jQuery(k).addClass("widget-start-marker");jQuery(this).append(k)}jQuery(k).click(_buttonInit);var i=jQuery(this).children(".widget-show-context-menu");if(i.length<1){i=document.createElement("div");jQuery(i).addClass("widget-show-context-menu");jQuery(this).append(i)}jQuery(i).click(function(){jQuery(this).parent().children(".widget-context-menu").toggle()});var j=jQuery(this).children(".widget-context-menu");if(j.length<1){var j=document.createElement("div");jQuery(j).addClass("widget-context-menu");var m="        <div class=\"widget-context-menu-item\" onClick=\"window.open('http://my.marker.to','_blank');\">"+TM_i18n.get("myMarkersLink")+"</div>           <div class=\"widget-context-menu-item\" onClick=\"window.open('http://marker.to','_blank');\">"+TM_i18n.get("howToMarkOtherSites")+"</div>                    <div class=\"widget-context-menu-item\" onClick=\"window.open('http://marker.to#what','_blank');\">"+TM_i18n.get("whatIsMarker")+"</div>            ";jQuery(j).html(m);jQuery(this).append(j)}jQuery(j).mouseleave(function(){jQuery(this).toggle()})})}}function _init(){if(!TMinit){document.onmouseup=_mouseUp;_buildWidgetButton();TM_track.addElements(TM_tracksectors)}if(TMmode=="widget"){return}if(TMmode=="viewer"){startMarker(false);return}if(TMmode=="panel"&&communicationKey&&communicationKey.split(".").length==2){startMarker(false);return}else{jQuery("#textmarker").remove();communicationKey=false}var e,g=0;while(true){try{e=jQuery(".textmarker_"+g);if(!e.get(0)){break}selection_count=parseInt(e.get(e.length-1).id.split("_")[1])+1;myhistory.push({});g++}catch(f){}if(g>1000){break}}jQuery('a[name^="marker"]').remove();if(!TMinit){_getCommunicationKey()}TMinit=true}function _clearSelection(){if(document.selection){document.selection.empty()}else{if(window.getSelection){window.getSelection().removeAllRanges()}}}function _mouseUp(e){var d=false;e=e||window.event;if(e.which){d=(e.which==3)}else{if(e.button){d=(e.button==2)}}if(donotselect){donotselect=false;return false}if(d){return false}if(e.target){targ=e.target}else{if(e.srcElement){targ=e.srcElement}}do{if(targ.id==tmdiv){return false}}while(targ=targ.parentNode);_initSelection(e);return true}function _showBubbleButton(h){var e=document.createElement("div");var k=document.createElement("a");e.className="share-selection-container";k.className="share-selection-button";jQuery(k).html(TM_i18n.get("shareSelectedText"));jQuery(e).mousedown(function(b){b.preventDefault()});jQuery(e).click(function(b){jQuery(e).remove();_buttonInit(b)});jQuery("#"+tmdiv).append(e);jQuery(e).append(k);jQuery(e).hover(function(){jQuery(this).stop(true);jQuery(this).animate({opacity:1})},function(){jQuery(this).fadeOut(2000,function(){jQuery(this).remove()})});var i=h.pageX,j=h.pageY;jQuery(e).css({left:i>0?i:0,top:j>0?j:0,position:"absolute"})}function _initSelection(l){var m,j,i;try{m=_getSelection();i=jQuery.trim(m.toString());if(i.length<1){return false}if(TMmode=="panel"&&!_checkComKey(true)){return}j=_getRange(m)}catch(k){}if(!j){return false}if(TMmode!="panel"){return}var e={};e.tagids=[];e.operation="selection";e.bgcolor=tmbgcolor;e.elements=[];e.selectiontext=i;e.rewraps=[];myhistory.push(e);wrapIntersectedElement(j.commonAncestorContainer,j);_clearSelection();TM_track.record("highlighttext");TMCom.send()}function _getSelection(){if(window.getSelection){return window.getSelection()}else{if(document.selection){return document.selection}}}function _getRange(e){if(e.getRangeAt){return e.getRangeAt(0)}if(document.createRange){var d=document.createRange();d.setStart(e.anchorNode,e.anchorOffset);d.setEnd(e.focusNode,e.focusOffset);return d}}function GetIndexOf(f){var g=f.parentNode?f.parentNode.firstChild:null;var e=-1;while(g){e++;if(g==f){return e}g=g.nextSibling}return -1}function GetSelectionMarkerTag(g){var h;try{h=document.selection.createRange()}catch(i){return null}if(h.parentElement().document!=document){return null}h.collapse(g===true);var e="fck_dom_range_temp_"+(new Date()).valueOf()+"_"+Math.floor(Math.random()*1000);h.pasteHTML('<span id="'+e+'"></span>');return document.getElementById(e)}function wrapIntersectedElement(f,e){if(f.childNodes&&f.childNodes.length>0){for(var g=0;f.childNodes[g];g++){wrapIntersectedElement(f.childNodes[g],e)}return}wrapTextNode(e,f)}function wrapTextNode(l,j){if(!isValidTextNode(l,j)){return}if(j.parentNode&&!!j.parentNode.className.match(/textmarker/g)){return}var m=document.createRange?document.createRange():document.selection.createRange();if(j==l.startContainer||j==l.endContainer){var i=(j==l.startContainer)?l.startOffset:0;var k=(j==l.endContainer)?l.endOffset:j.length;if(i==k){return}m.setStart(j,i);m.setEnd(j,k)}else{if(!!j.parentNode.className.match(/textmarker/g)){return}else{m.selectNode(j)}}var h=createWrapElement(tmbgcolor);m.surroundContents(h);m.detach();myhistory[myhistory.length-1].elements.push({added:h,removed:h.firstChild})}var cssClassName="textmarker";function createWrapElement(q){var s=myhistory.length-1;var p=document.createElement("span");p.className=cssClassName+" "+cssClassName+"_"+s;for(var o=0;o<myhistory[s].rewraps.length;o++){p.className+=" "+cssClassName+"_"+myhistory[s].rewraps[o]}p.id="textmarker_"+selection_count;p.style.backgroundColor=q?q:tmbgcolor;p.style.color="black";p.style.font="inherit";p.tmid=s;selection_count++;var l,r;if(!myhistory[s].tooltip){var n=document.createElement("div");var m=document.createElement("div");m.className="ui-icon";m.innerHTML='<div class="ui-icon-a textmarker-delete" title="'+TM_i18n.get("removeHighlightTooltip")+'"></div>';jQuery(m).hover(function(){jQuery(this).addClass("ui-state-hover")},function(){jQuery(this).removeClass("ui-state-hover")});jQuery(m).click(function(){unwrap(this.tmid)});m.tmid=n.tmid=s;m=jQuery(m);n=jQuery(n);n.addClass("textmarker-tooltip");n.append(m);n.append('<div class="ui-icon" title="'+TM_i18n.get("geoLocationTooltip")+'"><div class="ui-icon-a textmarker-add-map"></div></div>');n.append('<div class="ui-icon" title="'+TM_i18n.get("tagsTooltip")+'"><div class="ui-icon-a textmarker-add-tags"></div></div>');n.append(colorSelectBtn(s));n.append('<div class="textmarker-tooltip-share">'+_getShareHtml(false,myhistory[s].selectiontext)+"</div>");n.append('<div class="textmarker-tags">Add tags: <input type="text" name="tags" class="tags" value="" sid="'+s+'"/> (space separated) <a target="_blank" href="http://blog.marker.to/?p=121">read more</a></div>');n.find(".textmarker-add-map").click(TM_map_init).get(0).tmid=s;var i=n.find(".textmarker-add-tags");i.click(function(){jQuery(".textmarker-add-tags").toggleClass("on");if(jQuery(this).hasClass("on")){jQuery(".textmarker-tags").show()}else{jQuery(".textmarker-tags").hide()}});jQuery("#"+tmdiv).append(n);if(jQuery(".textmarker-add-tags").hasClass("on")){i.addClass("on");jQuery(".textmarker-tags").show()}else{jQuery(".textmarker-tags").hide()}n.find(".textmarker-tags input").blur(function(){var b={from:"tmtags",comId:communicationKey,tags:jQuery(this).val().trim(),sid:jQuery(this).attr("sid")};jQuery("#tm-savetags-frm").get(0).contentWindow.postMessage(b,document.location.protocol+"//marker.to")});myhistory[s].tooltip=n;n.hover(function(){jQuery(".textmarker-tooltip-edit-wrapper").remove();jQuery(this).stop(true);jQuery(this).animate({opacity:1})},function(){jQuery(this).fadeOut(2000,function(){var b=jQuery(this).find(".textmarker-tags input");if(b.get(0)==document.activeElement){jQuery(this).find(".textmarker-tags input").blur()}})})}l=function(b){if(jQuery(jQuery(".textmarker_"+this.tmid+" .textmarker-tooltip-edit-wrapper")).length>0){jQuery(".textmarker_"+this.tmid+" .textmarker-tooltip-edit-wrapper").stop(true);jQuery(".textmarker_"+this.tmid+" .textmarker-tooltip-edit-wrapper").animate({opacity:1});return}jQuery(jQuery(".textmarker_"+this.tmid).get(0)).prepend('<em class="textmarker-tooltip-edit-wrapper" tmid="'+this.tmid+'"><div class="textmarker-tooltip-edit"></div></em>');jQuery(".textmarker_"+this.tmid+" .textmarker-tooltip-edit-wrapper").click(function(c){c.preventDefault();c.stopImmediatePropagation();var d=jQuery(this).attr("tmid");if(myhistory[d].tooltip){var e=b.pageX,f=b.pageY;myhistory[d].tooltip.css({left:e>0?e:0,top:f>0?f:0});myhistory[d].tooltip.show();jQuery(this).remove();return}})};r=function(b){jQuery(".textmarker_"+this.tmid+" .textmarker-tooltip-edit-wrapper").fadeOut(2000,function(){jQuery(this).remove()})};jQuery(p).hover(l,r);return p}TM_map={loading:false,map:false,marker:false,lat:-34.397,lng:150.644,currentSelection:false,selections:{page:false}};function TM_map_loaded(){if(typeof jQuery.tools=="undefined"||typeof jQuery.tools.overlay=="undefined"){setTimeout("TM_map_loaded()",100)}TM_map.loading=false;if(!jQuery("#tm_map_canvas").length){jQuery("#"+tmdiv).append('<div id="tm_map_canvas" class="simple_overlay white modal" style=" width:640px;  height:500px;"></div>');var c={zoom:8,center:new google.maps.LatLng(TM_map.lat,TM_map.lng),mapTypeId:google.maps.MapTypeId.ROADMAP};jQuery("#tm_map_canvas").append('<div id="tm_map_keeper" style="width:100%; height:100%;"></div>');TM_map.map=new google.maps.Map(document.getElementById("tm_map_keeper"),c);google.maps.event.addListener(TM_map.map,"click",function(b){TM_map_add_marker(b.latLng);TM_map.selections[TM_map.currentSelection]={lat:b.latLng.lat(),lng:b.latLng.lng(),zoom:TM_map.map.getZoom()};TM_map_save_marker();TM_map_update_geotag()});jQuery("#tm_map_canvas").overlay({top:20,mask:{color:"#336",loadSpeed:200,opacity:0.5},closeOnClick:true,load:true})}else{jQuery("#tm_map_canvas").overlay().load()}}function TM_map_save_marker(f){f=f||"save";var g=TM_map.selections[TM_map.currentSelection];var e={comId:communicationKey,action:f,sid:TM_map.currentSelection};TM_post("savemap",jQuery.extend(e,g))}function TM_post(k,j){var o=(new Date()).valueOf()+"_"+Math.floor(Math.random()*1000);var l=document.createElement("form");l.action=comUrl+k;l.method="post";l.enctype=l.encoding="multipart/form-data";document.getElementById(tmdiv).appendChild(l);for(var i in j){var m=document.createElement("input");m.name=i;m.type="hidden";m.value=j[i];l.appendChild(m)}var n=document.createElement("div");n.style.display="none";n.innerHTML='<iframe width="0" height="0" id="frame_'+o+'" name="frame_'+o+'" src="javascript:void(0)"></iframe>';frame=n.firstChild;l.appendChild(n);l.target="frame_"+o;l.submit()}function TM_map_init(){TM_map.currentSelection=typeof this.tmid!="undefined"?this.tmid:"page";if(typeof google!="undefined"&&typeof google.maps!="undefined"){if(TM_map.marker){TM_map.marker.setMap(null)}if(typeof TM_map.selections[TM_map.currentSelection]!="undefined"){var c=TM_map.selections[TM_map.currentSelection];TM_map_add_marker(new google.maps.LatLng(c.lat,c.lng));TM_map_center(c.lat,c.lng,c.zoom)}TM_map_loaded();return}if(!TM_map.loading){loadScript("//maps.googleapis.com/maps/api/js?sensor=true&key=AIzaSyDaaevGw1ycsE3F_iLZ-w98bWF_8M_Rrgc&callback=TM_map_loaded");loadScript(comUrl+"jquery.tools.min.js");TM_map.loading=true;navigator.geolocation.getCurrentPosition(function(b){TM_map_center(b.coords.latitude,b.coords.longitude)},function(){})}jQuery(this).delay(100).queue(TM_map_init)}function TM_map_center(f,e,g){g=g||TM_map.map.getZoom();if(TM_map.map){TM_map.map.setCenter(new google.maps.LatLng(f,e));TM_map.map.setZoom(g)}}function TM_map_add_marker(c){if(TM_map.marker){TM_map.marker.setMap(null)}TM_map.marker=new google.maps.Marker({position:c,map:TM_map.map,draggable:true,visible:true});google.maps.event.addListener(TM_map.marker,"dragend",function(b){TM_map.selections[TM_map.currentSelection]={lat:b.latLng.lat(),lng:b.latLng.lng(),zoom:TM_map.map.getZoom()};TM_map_save_marker();TM_map_update_geotag()})}function TM_map_update_geotag(){var g=jQuery(".textmarker-geotag-"+TM_map.currentSelection);if(!g.length){var f=jQuery(".textmarker_"+TM_map.currentSelection);TM_track.record("maplocationadded");if(!f.length){return}jQuery(f.get(0)).prepend('<span class="geo textmarker-geotag textmarker-geotag-'+TM_map.currentSelection+'" style="display:none"></span>');g=jQuery(".textmarker-geotag-"+TM_map.currentSelection)}else{TM_track.record("maplocationmoved")}var e=TM_map.selections[TM_map.currentSelection];g.get(0).innerHTML='<span class="latitude">'+e.lat+'</span><span class="longitude">'+e.lng+'</span><span class="zoom">'+e.zoom+"</span>"}function rewrap(q,p){if(myhistory[q].bgcolor==p){return}jQuery(".textmarker_"+q).css("backgroundColor",p);myhistory[q].bgcolor=p;myhistory.push({});myhistory[q].tooltip.hide();myhistory[myhistory.length-1].operation="rewrap";myhistory[myhistory.length-1].selectiontext=myhistory[q].selectiontext;myhistory[myhistory.length-1].rewrappedid=q;var k=colorSelectBtn(q);var l=jQuery(myhistory[q].tooltip).find(".textmarker-color-palette");l.replaceWith(k);TMCom.send();return;myhistory.push({});myhistory[myhistory.length-1].selectiontext=myhistory[q].selectiontext;myhistory[myhistory.length-1].elements=[];myhistory[myhistory.length-1].bgcolor=p||bgcolor;myhistory[myhistory.length-1].operation="rewrap";myhistory[myhistory.length-1].rewrappedid=q;myhistory[myhistory.length-1].rewraps=myhistory[q].rewraps||[];myhistory[myhistory.length-1].rewraps.push(q);var n=myhistory[q].elements;for(var o=0;o<n.length;o++){var i=createWrapElement(myhistory[myhistory.length-1].bgcolor);if(typeof n[o].added.firstChild=="undefined"){continue}i.appendChild(n[o].added.firstChild);var m=n[o].added.parentNode.replaceChild(i,n[o].added);myhistory[myhistory.length-1].elements.push({added:i,removed:m})}TMCom.send()}function unwrap(g){myhistory.push({});myhistory[myhistory.length-1].elements=[];var i=el_current=myhistory[g];myhistory[myhistory.length-1].delid=g;myhistory[myhistory.length-1].selectiontext=i.selectiontext;myhistory[myhistory.length-1].rewraps=[];if(myhistory[g].tooltip){myhistory[g].tooltip.remove();myhistory[g].tooltip=null}while(true){if(i.operation=="rewrap"){i=myhistory[i.rewrappedid];continue}break}for(var f=0;f<i.elements.length;f++){var h=el_current.elements[f].added.parentNode.replaceChild(i.elements[f].removed,el_current.elements[f].added);myhistory[myhistory.length-1].elements.push({added:i.elements[f].removed,removed:h});continue}myhistory[myhistory.length-1].operation="deleted";TMCom.send()}function isValidTextNode(n,k){var l=document.createRange();l.selectNode(jQuery("#"+tmdiv)[0]);var j,m,o,i;if(!k.data||jQuery.trim(k.data).length<1){return false}i=n.intersectsNode&&n.intersectsNode(k);if(i){j=document.createRange();j.selectNode(k);m=l.compareBoundaryPoints(l.START_TO_START,j);o=l.compareBoundaryPoints(l.END_TO_END,j);if(m==0||o==0||(m==-1&&o==1)){inRange=true}else{inRange=false}if(inRange){return false}return true}else{return false}}function WarnUser(c){c=c||window.event;if(TMCom.getStatus()=="loading"){if(c){c.returnValue=TM_i18n.get("closeWarningA")}TM_track.record("closewarningA");return TM_i18n.get("closeWarningA")}else{if(jQuery("#textmarker").length){if(c){c.returnValue=TM_i18n.get("closeWarningB")}return TM_i18n.get("closeWarningB")}}}TM_track=function(){var h=null;var l=[];var i=[];function j(b){var c=i[b];if(typeof c.selector!="undefined"){var d=jQuery(c.selector);c.event=c.event||"click";try{d.live(c.event,function(e){TM_track.record(e,this,b)})}catch(c){console.log(c)}}}function m(c){if(i.indexOf(c)===-1){var b=i.push(c)-1;j(b)}}function k(b,c,g,r){var f="",d=TMmode;r=r||{};g=g||false;if(!g){for(var e in i){if(i[e].event==b){f=i[e].name;d=(typeof i[e].type!="undefined"?i[e].type:TMmode);break}}if(f==""){f=b;d=TMmode}}else{f=i[g].name;d=(typeof i[g].type!="undefined"?i[g].type:TMmode)}try{r.mode=TMmode;if(communicationKey){r.id=communicationKey.split(".")[0]}_gaq.push(["TM._trackEvent",d,f])}catch(q){console.log("Error",q)}return false}return{setIdentifier:function(b){h=b;try{_gaq.push(["TM._setCustomVar",1,"UserId",h,1])}catch(c){setTimeout("TM_track.setIdentifier('"+h+"');",500)}},addElement:function(b){m(b)},addElements:function(b){for(el in b){m(b[el])}},record:k}}();TM_tracksectors=[{selector:"#textmarker-url-input",name:"Share url active"},{selector:"#textmarker-url-input",event:"dblclick",name:"Share url open in new page"},{selector:"#tmloading .textmarker-logo",name:"Clicked on logo"},{selector:".viewer-panel .textmarker-close",name:"Viewer close panel",type:"viewer"},{selector:".textmarker-panel .textmarker-close",name:"Close panel",type:"panel"},{selector:".textmarker-panel-body .textmarker-twitter-btn",name:"Twitter click on panel"},{selector:".textmarker-tooltip-share .share-buttons",name:"Twitter click on selection"},{selector:".textmarker-delete",name:"Selection delete"},{selector:".original-page-link",name:"Click on original page link"},{selector:".textmarker-color-palette",name:"Selection change color"},{selector:".textmarker-tt",name:"Clicked on tooltip"},{selector:".textmarker-tt .textmarker-tt-close",name:"Tooltip close"},{selector:".widget-start-marker",name:"Widget start marker",type:"widget"},{selector:".widget-context-menu-item",name:"Widget clicked on context menu",type:"widget"},{selector:".widget-show-context-menu",name:"Widget show context menu",type:"widget"},{selector:".share-selection-container",name:"Selection Share button clicked",type:"viewer"},{selector:"#tmloading .viewer-click-count-label",name:"Clicked on View Count"},{selector:"#tmloading .viewer-install-action .install-button",name:"Clicked on Install button"},{selector:"#tmloading .viewer-original-page-link",name:"Clicked on Orig.page link"},{selector:"#tmloading .viewer-twitter-button",name:"Clicked on Twitter button"},{selector:"#tmloading .textmarker-add-map",name:"Clicked on Map button"},{selector:"#tmloading #textmarker_donate_btn",name:"GoPremium"}];TM_track.addElements([{event:"highlighttext",name:"Highlight text"},{event:"startmarker",name:"Panel started"},{event:"markerreopen",name:"Panel reopened"},{event:"startviewer",name:"Viewer starter"},{event:"closewarningA",name:"User tried to close marker while saving."},{event:"comKeyError",name:"Communication key error"},{event:"maplocationadded",name:"Map location added"},{event:"maplocationmoved",name:"Map location moved"}]);var TMmode="viewer";function checker(){if(typeof jQuery!="undefined"&&typeof TM!="undefined"){var b=jQuery(jQuery(".textmarker").get(0)).offset();if(b){jQuery(window).scrollTop(b.top-140)}_init()}else{setTimeout("checker();",100)}}checker();var _gaq=_gaq||[];_gaq.push(["TM._setAccount","UA-19614689-1"]);_gaq.push(["TM._setDomainName","marker.to"]);_gaq.push(["TM._setAllowLinker",true]);_gaq.push(["TM._trackPageview"]);(function(){var d=document.createElement("script");d.type="text/javascript";d.async=true;d.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";try{var b=document.getElementById("tmloading");b.parentNode.insertBefore(d,b)}catch(c){var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(d,b)}})();